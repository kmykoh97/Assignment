# CPU Technical Report

# 摘要

> 中央处理器（CPU，Central Processing Unit）是一块超大规模的集成电路，是一台计算机的运算核心（Core）和控制核心（ Control Unit）。它的功能主要是解释计算机指令以及处理计算机软件中的数据。 中央处理器主要包括运算器（算术逻辑运算单元，ALU，Arithmetic Logic Unit）和高速缓冲存储器（Cache）及实现它们之间联系的数据（Data）、控制及状态的总线（Bus）。它与内部存储器（Memory）和输入/输出（I/O）设备合称为电子计算机三大核心部件。

本文将通过分析Intel与AMD两家处理器产商最新的几款CPU在CPU制造的各个方面，给出他们两家产品的对比，优劣，以及分析处理器的发展以及评价标准。

# 各供应商CPU产品的分析

## 制造工艺

>CPU制作工艺指的是在生产CPU过程中，要加工各种电路和电子元件，制造导线连接各个元器件等。现在其生产的精度以纳米（以前用微米）来表示，精度越高，生产工艺越先进。在同样的材料中可以容纳更多的电子元
件，连接线也越细，有利于提高CPU的集成度。制造工艺的纳米数是指IC内电路与电路之间的距离。制造工艺的趋势是向密集度愈高的方向发展，密度愈高的IC电路设计，意味着在同样大小面积的IC中，可以拥有密度更高、功能更复杂的电路设计。

AMD锐龙9和锐龙5系列的制造工艺为7nm，而Intel酷睿i9和i7系列的制造工艺为14nm.  
制造工艺越小，CPU核心面积减少，集成度越高，可以实现性能的提升和功耗的降低，并且可以节省材料和成本；

AMD的制造工艺优于Intel。AMD的锐龙系列确实价格比起Intel要便宜。但Intel芯片的稳定性比AMD好，并且长久以来Intel对市场的掌控，使得AMD的CPU在市场上仍处于劣势。

## 核心微架构

AMD与Intel虽然都是使用x86的指令集架构，但是他们有着不同的微架构。

>微架构（英语：microarchitecture），也被叫做计算机组织，微架构使得指令集架构（ISA）可以在处理器上被运行。指令集架构可以在不同的微架构上运行。 计算机结构是一门探讨微架构与指令集两者交互的一门学问。每个微架构的的组件都被表示成藉数个逻辑门所建构而成的工具。每个逻辑门都被表示成藉晶体管建构成的零件。拥有不同微架构的机器可能拥有相同的指令集架构，因此可以运行相同的程序。由于半导体科技的进步，新型的处理器可以以较快的速度运行相同的指令集架构。

---

AMD使用的是Zen
>Zen是一种x86-64微架构，由AMD开发，2016年发表，取代Bulldozer微架构及其改进版本。该微架构是AMD重返高性能运算市场的重要产品，与旧有架构相比几乎完全重新设计并以新工艺制作以提升性能，同时还引入众多新特性，处理器产品以SoC或半SoC形态面市。而首款Zen微架构的处理器，核心代号“Summit Ridge”，正式品牌名称为“Ryzen”，而中文名称为“锐龙”，于2017年3月2日正式上市。

而Intel目前使用的最新的微架构是Coffee Lake微架构
>Coffee Lake 是 Intel 继 Skylake 和 Kaby Lake 之后的新一代 14 纳米制程的处理器系列分配的代号。 这些处理器的内置显示核心都支持 DP 1.2、HDMI 2.0 和 HDCP 2.2 连接，且原生支持在 2666 兆赫兹频率下的双通道 DDR4 内存。桌面端的 Coffee Lake 处理器与旧一代酷睿处理器来说主要的变化就是 i5 和 i7 均提供六颗核心（i7具有超线程技术），而对于 i3 来说，Intel第一次提供 4 核的标准 i3 处理器。该架构的芯片已于 2017 年 10 月 5 日推出市场。 它使用 300 系列的芯片组，与旧的 100 和 200 系列芯片组不兼容，而 300 系芯片组的主板亦无法安装六代或七代的酷睿 CPU。而下一代架构仍旧会使用 14nm+++ 工艺直到 14nm 已不足以提供更多性能为止。

![intel处理器](https://github.com/HokhyTann/Assignment/blob/master/img/1.png)
![AMD处理器](https://github.com/HokhyTann/Assignment/blob/master/img/2.png)

从多数媒体的首发性能评测而言，首发产品Ryzen 7系列的每个CPU核心的性能及多线程性能已经达到Intel Haswell/Boardwell微架构在同时脉下的水准，能源效率则更佳，多线程的需求是Ryzen的优势，其竞争对手的处理器产品采用旧一代的架构时的默认时脉也不会如此高。  

但不足之处是，一来受制于制造工艺，最高时脉及能源效率不如对手英特尔最新的Skylake/Kaby Lake微架构的产品（Intel的14纳米制程，在许多方面表现的都优于其他晶圆厂的14/16nm制程），尽管Skylake/Kaby Lake微架构同时脉下性能与Haswell/Boardwell微架构的相比仅5%的性能差别[48][49]；二来是长久以来AMD高性能系统平台的缺席、市占劣势，间接导致不少软件对AMD处理器的性能最优化不良，特别是一些计算机游戏（一些游戏性能测试结果显示似乎这些游戏并不适应AMD的同步多线程，出现性能不升反降的情况，以网络游戏为重灾区）  

当前英特尔主要以制造工艺优势和默认高时脉优势与AMD拉开差距，为维持x86处理器的性能领导地位，英特尔推出了Core i9系列，市场定位相当于以往的Core i7极致版，但规格更为夸张（特别是时脉参数上，尽管耗电和发热量上也有所增长）。针对企业级市场打造的EPYC，则在大数据处理以及高性能运算上乐胜英特尔的Xeon系列，但是在数据库处理方面则不敌对手。

## 核心/线程

>多核心处理器（英语：Multi-core processor），又称多核心微处理器，是在单个计算组件中，加入两个或以上的独立实体中央处理单元（简称核心，英语：Core）。这些核心可以分别独立地运行程序指令，利用并行计算的能力加快程序的运行速度。只有两个核心的处理器，称为双核心处理器（dual-core processor）。“多核心”通常是对于中央处理器（Central Processing Unit，CPU）而论的，但是某些时候也指数字信号处理器（DSP）和系统芯片（SoC）。

而Intel研发了一种叫做超线程的技术，可以使一个核同时执行两个线程
>CPU的线程数概念仅仅只针对Intel的CPU才有用，因为它是通过Intel超线程技术来实现的，最早应用在Pentium4上。如果没有超线程技术，一个CPU核心对应一个线程。所以，对于AMD的CPU来说，只有核心数的概念，没有线程数的概念。

使用多核/多线程的好处是：在最佳情况下，每多一个核，计算速度就可以提高一倍。

在CPU的功耗/散热/延迟/设计复杂度等问题遇到瓶颈时，功耗问题限制了单核处理器不断提高性能的发展途径。为了继续提高CPU的速度，英特尔的工程师提出了多核处理器的技术。但是多核处理器也有瓶颈。 

>一方面是软件上，可编程性是多核处理器面临的最大问题。一旦核心多过八个，就需要执行程序能够并行处理。尽管在并行计算上，人类已经探索了超过40年，但编写、调试、优化并行处理程序的能力还非常弱。如果程序无法充分利用这些内核的话，那么多核与单核也就没有什么区别。  
>另一方面是硬件上，首先是内存带宽，内存带宽不可能无限增加，而多核处理器会争抢带宽，导致性能非线性增长。其次是总线瓶颈，多线程数据共享时。不同处理器要遵从缓存一致性协议，以确保共享数据结构不会被多个处理器撕裂。当大量处理器核心同时发起缓存一致性请求时，就会形成缓存一致性风暴。总线带宽会形成瓶颈。然后是暗硅。见2011年IBM在ISCA的论文。登纳德定律走到尽头，先进工艺在更小的面积中集成更多内核时。会导致热密度失控。所以处理器的内核不得不运行在更低频率或者休眠。使得多核收益降低。

CPU的单核发展已经遇到瓶颈，而多核也不能一直继续下去，因此，找到一种新的技术方案就成为CPU继续发展的重要任务。

从上面那张图中可以看到AMD主打性能的3700x和3800x都是八核16线程。而发烧级的3950X甚至达到了16核32线程。而锐龙线程撕裂者2990WX为32核，64线程。  

而Intel i9为八核16线程，i7为八核八线程。Intel的至强W-3175X为28核56线程  

从CPU性能上看，锐龙线程撕裂者2990WX要优于至强W-3175X。锐龙3950X与i9-9960X相当。而锐龙3700X与3800X比i7的各个型号性能都要好，甚至超过一部分i9。
i7-9800的售价为4599，而3800X的售价为2699。AMD在这两款CPU上的性价比要优于Intel。但是AMD所采用的是两倍的内核数量，而性能的提升并不是很高，说明AMD的工艺比起Intel差了一些。而AMD的多核会带来功耗较大的问题，使得散热要求较高。

## 频率

>时钟频率（又译：时钟频率速度，英语：clock rate），是指同步电路中时钟的基础频率，它以“若干次周期每秒”来度量，量度单位采用SI单位赫兹（Hz）。它是评定CPU性能的重要指标。一般来说主频数字值越大越好。外频，是CPU外部的工作频率，是由主板提供的基准时钟频率。

对某些CPU来说，将时钟频率降低一半（降频），一般来说性能也将降低一半，同时此CPU产生的热量也将减少到原来的一半  
与此相对的，有些人试图提高CPU性能，为此他们尝试让CPU运行在一个较高的时钟频率上（超频）[1]。对他们来说他们的超频行为可能会很快受到下面一条或者两条条件的限制:

>* 在一个时钟脉冲后，CPU的信号线需要时间稳定它的新状态。如果上一个脉冲的信号还没有处理完成，而下一个时钟脉冲来的太快（在所有信号线完成从0到1或者从1到0的转换前），就会产生错误的结果。芯片制造商制定了“最高时钟频率”的规范，并且在出售芯片之前对它们进行测试确保它们符合“最高时钟频率”的规范。测试将执行最复杂的指令，处理最复杂的数据模型确定使用的最长处理时间（测试在最合适的电压和稳定保证CPU在最低性能下运行），保证最高时钟频率时不会发生冲突。
>* 当信号线从1转换到0状态（也可以是0转换到1状态）时，将会浪费部分能量使之转换为热能（主要是内部驱动晶体管）。当CPU执行复杂指令，由此进行大量的1状态0状态之间的互相转换时，更高的时钟频率将产生更多的热量。如果产生的热量不能被散热系统及时带走，晶体管将可能因此过热损坏。

因此，随着CPU时钟周期的增加，一方面其他的硬件比如传输的总线无法跟上CPU的速度，另一方面会产生大量的热量，导致CPU损坏。第一台IBM PC的频率是4.77MHZ,而到2002年，最快的CPU达到了3GHZ。但是最近的CPU大多在4GHZ左右，增长速度已经减慢了很多，如果上面这两个问题无法解决的话，CPU主频的频率将会难以继续提高。  

![ ](https://github.com/HokhyTann/Assignment/blob/master/img/3.jpg)
从图中可以看到随着CPU主频的提高，功耗的增长速度会逐渐增加。

在21世纪初期，有的CPU产商为了提高CPU主频作为卖点，强行增加流水线数量。第三代P4波塞冬核心（Prescott）把流水线长度增加到了31级，缓存也加大了，相应也把频率频率拉的很高，但是大家很快就发现虽然频率高但是实际运行效率却没有北木那么高，3.2G以下波塞冬竟然打不过北木，发热和功耗也成为了劣势，高频低能就是说波塞冬。然后就是AMD的速龙64系列CPU的横空出世，20级恰到好处的流水线长度，控制得很好的发热和功率，频率不高而实际效率高。当时悲剧的英特尔总裁贝瑞特在IDF05上给大众下跪：
[英特尔CEO当众下跪道歉](http://business.sohu.com/20041029/n222752623.shtml)

酷睿i9-9900K的核心频率为3.6GHZ，加速频率为5GHZ。  
酷睿i7-9700k的核心频率为3.5GHZ,加速频率为4.9GHZ。  
锐龙9 3950X的核心频率为3.5GHZ，加速频率为4.7GHZ。  
锐龙7 3800X的核心频率为3.9GHZ,加速频率为4.5GHZ.

差别都不是很大。

## 二/三级缓存

>在计算机系统中，CPU高速缓存（英语：CPU Cache，在本文中简称缓存）是用于减少处理器访问内存所需平均时间的部件。在金字塔式存储体系中它位于自顶向下的第二层，仅次于CPU寄存器。其容量远小于内存，但速度却可以接近处理器的频率。
当处理器发出内存访问请求时，会先查看缓存内是否有请求数据。如果存在（命中），则不经访问内存直接返回该数据；如果不存在（失效），则要先把内存中的相应数据载入缓存，再将其返回处理器。

酷睿i9-9900K的三级缓存为16MB  
酷睿i7-9700k的三级缓存为12MB  
锐龙9 3950X的二/三级缓存为8/64MB  
锐龙7 3800X的二/三级缓存为4/32MB  
可以锐龙的缓存更大一些，但是对处理器性能的提升幅度并不是很大。

二/三级缓存可以加快处理器读取内存的时间，在一定程度上提升CPU的性能，但是也要依赖程序具有良好的空间局部性和时间局部性才能发挥出效果。总的来说处理器缓存对处理器性能的影响较小。

## 核显

>集成图形处理器，或称集成显卡（集显）、核芯显卡（核显）和内建显示核心，是设在主板或CPU上的图形处理器，运作时会借用计算机内部分的系统内存。

集成显卡的性能较弱，因此，集显往往会被认为不适合执行3D游戏或精密的图形运算。但是集成显卡非常省电，它不需要单独供电。节能带来的另一个好处就是低热量， 集显移至处理器后，由于GPU及CPU工艺相同，可以减低TDP。而且，由于它们的标准化，您很少遇到驱动程序或兼容性的任何问题。但是集显的显示器接口较少，一般只有一个VGA接口、一个DVI接口和一个HDMI接口。

有的处理器自带的核显可以完成日常办公的需求，而在需要玩游戏，或者使用图形处理软件时，以及需要多屏显示的时候，都需要再购买一个独立显卡。

Intel酷睿系列都带有UHD 630 350-1200MHz的核显。而AMD锐龙7以上都不具有核显。这也使得锐龙系列价格更加低廉。

但是通常电脑产商都会给电脑加上一个独显，所以这个核显其实用处也不是很大。只是在自己装机的时候如果只用来办公并且想要节省经费可以选择使用带有核显的处理器。

## 功耗

>热设计功耗（英语：Thermal Design Power，缩写 TDP，又译散热设计功率）的含义是当芯片达到最大负荷的时候〔单位为瓦（W）〕热量释放的指标，是计算机的冷却系统必须有能力驱散热量的最大限度，但不是芯片释放热量的功率。

功耗一方面需要冷却系统降温，由此会带来许多能源损耗。另一方面电路中消耗的能量全部转化成了热能，功耗大也就说明处理器本身耗费的能量较大。而随着人类对环境越来越重视，对资源利用率的重视。大功耗处理器将会不再那么受欢迎。

有的主机采用水冷降温，水冷比起风扇来说噪音较少，散热效果也较好。但是水冷散热器所需空间较大，价钱要高于风冷。并且结构更复杂，更可能出现故障损害电脑零件。

酷睿i9-9900K的热设计功耗为95W  
酷睿i7-9700K的热设计功耗为95W  
酷睿i9-9900T的热设计功耗为35W  
锐龙9 3950X的热设计功耗为105W  
锐龙7 3800X的热设计功耗为105W  

可见Intel处理器的功耗要优于AMD。
注意到i9-9900T的功耗仅为35W，这大概是Intel推出的低功耗版处理器，相应的它的核心频率只有2.1GHZ，加速频率为4.4GHZ，Intel通过降低主频来减少热功耗，这款处理器对于处理器性能要求不高的情况十分适用。如何在保持性能不变甚至提高性能的基础上不断降低功耗应该会是未来处理器厂商的一个目标。
